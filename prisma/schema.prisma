generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Job {
  id String @id @default(cuid())
  username String
  postPrompt String @map("post_prompt")
  bloggerPrompt String? @map("blogger_prompt")
  allVideos Boolean @map("all_videos")

  // pending -> fetching_started, fetching_finished -> downloading_started, downloading_finished,
  // framing_started, framing_finished -> analyzing_started, analyzing_finished -> completed, failed
  status String @default("pending")
  reason String? // error reason

  postNumber Int @default(10) @map("post_number")

  attempts Int @default(0)

  analyzeRawText String? @map("analuze_raw_text")

  // Relations
  reels Reels[]
  posts Post[]

  @@map("jobs")
}

model Post {
  id String @id @default(cuid())

  postUrl String @map("post_url")
  filepath String? @map("file_path")
  downloadUrl String

  isVideo Boolean @default(false) @map("is_video")

  reason String? @map("reason")

  jobId String @map("job_id")
  job Job @relation(fields: [jobId], references: [id], onDelete: Cascade)

  analyzeRawText String? @map("analuze_raw_text")

  @@map("posts")
}

model Reels {
  id String @id @default(cuid())

  reelsUrl String @map("reels_url")
  downloadUrl String? @map("video_url")

  filepath String? @map("file_path")

  reason String? @map("reason")

  jobId String @map("job_id")
  job Job @relation(fields: [jobId], references: [id], onDelete: Cascade)

  analyzeRawText String? @map("analuze_raw_text")

  @@map("reels_urls")
}