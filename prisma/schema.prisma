generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Job {
  id String @id @default(cuid())
  username String
  followers Int @default(0)
  postPrompt String @map("post_prompt")
  bloggerPrompt String? @map("blogger_prompt")
  allVideos Boolean @map("all_videos")

  // pending -> fetching_started, fetching_finished -> downloading_started, downloading_finished,
  // framing_started, framing_finished -> speech_to_text_started, speech_to_text_finished ->
  // analyzing_started, analyzing_finished -> completed, failed
  status String @default("pending")
  reason String? // error reason

  postNumber Int @default(10) @map("post_number")

  attempts Int @default(0)

  analyzeRawText String? @map("analyse_raw_text")
  nicknameAnalyseRawText String? @map("nickname_analyse_raw_text")
  score Float?

  // Relations
  reels Reels[]
  posts Post[]
  stories Story[]

  @@map("jobs")
}

model Post {
  id String @id @default(cuid())

  postUrl String @map("post_url")
  filepath String? @map("file_path")
  downloadUrl String

  isVideo Boolean @default(false) @map("is_video")

  reason String? @map("reason")

  jobId String @map("job_id")
  job Job @relation(fields: [jobId], references: [id], onDelete: Cascade)

  analyzeRawText String? @map("analuze_raw_text")

  commentCount Int? @default(0) @map("comment_count")
  commentRate Float? @default(0) @map("comment_rate")

  comments Comment[]

  @@map("posts")
}

model Reels {
  id String @id @default(cuid())

  reelsUrl String @map("reels_url")
  downloadUrl String? @map("video_url")

  filepath String? @map("file_path")

  reason String? @map("reason")

  transcription String?

  jobId String @map("job_id")
  job Job @relation(fields: [jobId], references: [id], onDelete: Cascade)

  analyzeRawText String? @map("analuze_raw_text")

  commentCount Int? @default(0) @map("comment_count")
  commentRate Float? @default(0) @map("comment_rate")

  comments Comment[]

  @@map("reels_urls")
}

model Story {
  id String @id @default(cuid())

  storyId String @map("story_id")
  downloadUrl String @map("download_url")
  filepath String?
  reason String?

  transcription String?

  isVideo Boolean @default(false) @map("is_video")

  jobId String @map("job_id")
  job Job @relation(fields: [jobId], references: [id], onDelete: Cascade)

  analyzeRawText String? @map("analuze_raw_text")

  @@map("stories")
}

model Comment {
  id      Int     @id @default(autoincrement())
  postId  String? @map("post_id")
  reelsId String? @map("reels_id")
  post    Post?   @relation(fields: [postId], references: [id], onDelete: Cascade)
  reels   Reels?  @relation(fields: [reelsId], references: [id], onDelete: Cascade)
  text    String
  analyseRawText String? @map("analyse_raw_text")

  @@map("comments")
}